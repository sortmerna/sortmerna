# @copyright 2016-2021  Clarity Genomics BVBA
# @copyright 2012-2016  Bonsai Bioinformatics Research Group
# @copyright 2014-2016  Knight Lab, Department of Pediatrics, UCSD, La Jolla
#
# SortMeRNA - next-generation reads filter for metatranscriptomic or total RNA
# This is a free software: you can redistribute it and/or modify
# it under the terms of the GNU Lesser General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# SortMeRNA is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public License
# along with SortMeRNA. If not, see <http://www.gnu.org/licenses/>.
#
# contributors: Jenya Kopylova   jenya.kopylov@gmail.com
#			          Laurent Noé      laurent.noe@lifl.fr
#			          Pierre Pericard  pierre.pericard@lifl.fr
#			          Daniel McDonald  wasade@gmail.com
#			          Mikaël Salson    mikael.salson@lifl.fr
#			          Hélène Touzet    helene.touzet@lifl.fr
#			          Rob Knight       robknight@ucsd.edu

#
# file: test.jinja.yaml
# created: Oct 27, 2019 Sun
#
# Tests configuration
# Rendered using Jinja
#

test.list:
  #                         output type                                       |    alignment type
  #        refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other | best  N  min_lis seeds
  - t0:    [ 1,    1,    0,   0,     0,        0,      0,    0,    0,    0,      1,   1,    2,     2 ]
  - t0_1:  [ 1,    1,    0,   0,     0,        0,      0,    0,    0,    0,      1,   1,    2,     2 ]
  - t1: test_blast_format_1 - single reference + single read
  - t2: test_cigar_lcs_1
  - t3: test_environmental_output
  - t4: test_indexing_split_databases. No alignment, just a multi-part index build
  - t5: test_mate_pairs - part 1
  - t6:
  - t7:
  - t8:
  - t9: test_output_all_alignments_f_rc
  - t10:
  - t11: 
  - t12:   [ 1,    1,    0,   0,      0,       0,      0,    0,    0,    1,      1,   5,    2,     2 ]
  - t13:
  - t14:
  - t15:
  #                         output type                                       |    alignment type
  #        refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other | best  N  min_lis seeds
  - t16:   [ 2,    2,    1,   1,     0,        0,      0,    0,    1,    0,      1,   1,    2,     2 ]
  - t16_2: [ 2,    2,    1,   1,     0,        0,      0,    0,    1,    0,      1,   0,    2,     2 ]
  - t16_3: [ 2,    2,    1,   1,     0,        0,      0,    0,    1,    0,      1,   2,    2,     2 ]
  - t16_4: [ 2,    2,    1,   1,     0,        0,      0,    0,    1,    0,      0,   1,    2,     2 ]
  - t16_5: [ 2,    2,    1,   1,     0,        0,      0,    0,    1,    0,      0,   2,    2,     2 ]
  - t16_6: [ 2,    2,    1,   1,     0,        0,      1,    0,    1,    0,      1,   1,    2,     2 ]
  - t16_7: [ 2,    2,    1,   1,     0,        0,      0,    1,    1,    0,      1,   1,    2,     2 ]
  - t16_8: [ 2,    2,    1,   1,     0,        0,      1,    1,    1,    0,      1,   1,    2,     2 ]
  # TODO: zout not yet ready. 20210204 Thu
  - t16_9: [ 2,    2,    1,   1,     0,        0,      1,    1,    1,    1,      1,   1,    2,     2 ]
  #
  - t17:
  - t18:
  #                         output type                                       |    alignment type
  #        refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other | best  N  min_lis seeds
  - t19:   [ 2,    2,    0,   1,      1,       0,      0,    0,    0,    1,      1,   1,    2,     2 ]
  - t19_1: [ 2,    2,    0,   1,      1,       0,      1,    0,    0,    1,      1,   1,    2,     2 ]
  - t19_2: [ 2,    2,    0,   1,      0,       1,      0,    0,    0,    1,      1,   1,    2,     2 ]
  - t19_3: [ 2,    2,    0,   1,      0,       1,      1,    0,    0,    1,      1,   1,    2,     2 ]
  - t19_4: [ 2,    2,    0,   1,      0,       0,      1,    0,    0,    1,      1,   1,    2,     2 ]
  - t19_5: [ 2,    2,    0,   1,      0,       0,      1,    0,    1,    0,      1,   1,    2,     2 ]
  #
  - t20:   [ 2,    1,    0,   1,      1,       0,      0,    0,    0,    1,      1,   1,    2,     2 ]
  - t20_1: [ 2,    1,    0,   1,      1,       0,      1,    0,    0,    1,      1,   1,    2,     2 ]
  - t20_2: [ 2,    1,    0,   1,      0,       1,      0,    0,    0,    1,      1,   1,    2,     2 ]
  - t20_3: [ 2,    1,    0,   1,      0,       1,      1,    0,    0,    1,      1,   1,    2,     2 ]
  - t20_4: [ 2,    1,    0,   1,      0,       0,      1,    0,    0,    1,      1,   1,    2,     2 ]
  #
  - t21:
  - t22:
  - t23:
  - t24:
  - t25:
  - t26:
  - t27:
  - t28:
  - t29:
  - t30:
  #                         output type                                       |    alignment type
  #        refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other | best  N  min_lis seeds
  - t31:
  - t32:
  - t33:
  - t34:
  - t35:
  - t36:
  - t37:
  - t38:
  - t39:
  #                         output type                                       |    alignment type
  #        refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other | best  N  min_lis seeds
  - t40:   [ 2,    2,    0,   1,      0,       0,      1,    1,    1,    0,      1,   1,    2,     2 ]
  #       stress test: 8 refs + 1M reads
  - t41:   [ 2,    2,    1,   1,      0,       0,      1,    1,    1,    0,      1,   1,    2,     2 ]
  #       stress test: 8 refs + 10M reads
  - t42:   [ 2,    2,    1,   1,      0,       0,      1,    1,    1,    0,      1,   1,    2,     2 ]
  #       stress test: 8 refs + 50M reads
  - t43:   [ 2,    2,    1,   1,      0,       0,      1,    1,    1,    0,      1,   1,    2,     2 ]
  #       test catenated gzip - issue 221,263,272,283: 1 ref + 2 files (224) reads
  - t44:   [ 2,    2,    1,   1,      0,       0,      1,    0,    1,    0,      1,   1,    2,     2 ]
  #       test catenated gzip - issue 221,263,272,283: 8 refs + 2 files (1M) reads
  - t44_2: [ 2,    2,    1,   1,      0,       0,      1,    1,    1,    1,      1,   1,    2,     2 ]
  #       issue 288 8 refs + 1 files (1M) reads
  - t45:   [ 2,    1,    1,   1,      0,       0,      1,    1,    1,    1,      1,   1,    2,     2 ]

t0:
  name: blast + single ref + single read
  inf: |
    single reference + single read
    Compares expected alignment (see 't0.validate.files[0]' below) to the newly produced one

    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     1      1      -        -           -         -     -     -    -

    best  N  min_lis seeds
    ----------------------  alignment type
      1   1    2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/test_ref.fasta
    - -reads
    - {{ SMR_SRC }}/data/test_read.fasta
    - -sam
    - -blast
    - '0'
    - -v
    - -threads
    - '1'
    - -workdir
    - {{WRK_DIR}}
  validate: 
    func: t0 # name of the validation function
    num_reads:         1
    num_hits:          1
    num_fail:          0
    min_len:        1487
    max_len:        1487
    blast_score:    2430
    blast_bitscore: 2069
    files:
      - {{ SMR_SRC }}/data/t0_expected_alignment.blast

t0_1:
  name: test_blast_format_0_other
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout other
    ------------------------------------------------------------------ output type
     1      1      -        -           -         -     -     -    -

    best  N  min_lis seeds
    ----------------------  alignment type
      1   1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/test_ref.fasta
    - -reads
    - {{ SMR_SRC }}/data/test_read.fasta
    - -sam
    - -blast
    - '1 qstrand qcov'
    - -v
    - -threads
    - '1'
  validate: 
    func:
    files:
      aligned.log:
        num_reads:     1
        num_hits:      1
        num_fail:      0
        min_len:    1487
        max_len:    1487
      aligned.blast:
        num_recs: 1
        n_yid_ycov: 0
      aligned.sam:
    blast_score:    2430
    blast_bitscore: 2069
    ref:
      - {{ SMR_SRC }}/data/t0_expected_alignment.blast

t1:
  name: test_blast_format_1
  inf: |
    same input as t0
    using default number of threads (2)
    blast format is different than tests 0, 0_other
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/test_ref.fasta
    - -reads
    - {{ SMR_SRC }}/data/test_read.fasta
    - -sam
    - -blast
    - '1'
    - -v
    - -threads
    - '1'
  validate: 
    func:
    files:
      aligned.log:
        num_reads:  1
        num_hits:   1
        num_fail:   0
        min_len: 1487
        max_len: 1487
      aligned.blast:
        num_recs: 1
        n_yid_ycov: 0
      aligned.sam:
      pid_pcov.blast:
    ref:
      - {{ SMR_SRC }}/data/t0_expected_alignment.blast

t2:
  name: test_cigar_lcs_1
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/test_ref.fasta
    - -reads
    - {{ SMR_SRC }}/data/test_read.fasta
    - -sam
    - -blast
    - '1 qstrand cigar'
    - -v
    - -threads
    - '1'
    #- -workdir
    #- {{ SMR_SRC }}/run
  validate: 
    func: t2
    # expected alignment
    expected: [ "AB271211", "Unc49508", "93.5", "1430", "64", "30", "58", "1487", "1", "1446", "0",
              "2069", "+", "57S57M2I12M2D4M2I29M1D11M2I3M2D11M1I7M1D13M5D4M3D9M2D3M7D1260M" ]

t3:
  name: test_environmental_output
  info: |
    search for a single best alignment per read i.e.

    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     1      1      -        -           -         -     -     -    -

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set2_environmental_study_550_amplicon.fasta
    - -max_pos
    - '250'
    - -otu_map
    - -de_novo_otu
    - -id
    - '0.97'
    - -coverage
    - '0.97'
    - -fastx
    - -other
    - -blast
    - '1 cigar qcov'
    - -v
    #- -no-best
    #- -num_alignments
    #- '2'
    - -threads
    - {{THREADS or '\'4\''}}
    - -dbg-level
    - {{DBG_LEVEL or '\'0\''}}
    - -task
    - {{TASK or '\'4\''}}
  validate: 
    func:
    non_aligned_id: L1S23.273699_272664 # 0_64412  the only non-aligned read of this test
    files:
      aligned.log:
        num_reads:     100000
        num_hits:       99999
        num_fail:           1
        n_yid_ycov:     47981 # lin:43678  pass SW + %Cov + %ID
        n_denovo:        4441 # lin:11080  (52018 420) pass SW & fail (%Cov & %ID)   num_denovo + num_pass_id_cov = num_hits
        num_groups:       265 # LIN:257, WIN:4441
      aligned.fa:       99999
      other.fa:             1
      aligned_denovo.fa: 4441
      otu_map.txt:        265
      aligned.blast:
        num_recs:       99999 # num_pass_id_cov + num_denovo + num_y_id_n_cov + num_n_id_y_cov = 19995 = num_hits
        n_yid_ycov:     47981 # lin:43678  num_pass_id ⋂ num_pass_cov
        n_yid_ncov:      1513 # lin:6571   ID + !COV
        n_nid_ycov:     46064 # lin:38670  !ID + COV
        n_denovo:        4441 # lin:11080  !ID + !COV 
    runtime:
      win:
        - threads: 8
          sec: [13, 0.7, 4] # align, log, reports

t4:
  name: test_indexing_split_databases
  info: |
    No alignment is performed, just building a multi-part index
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/gg_13_8_ref_set.fasta # 27,424 bytes (27KB) file
    - -reads
    - {{ SMR_SRC }}/data/test_read.fasta # single read
    - -m
    - '0.05'
    - -v
    - -index
    - '1'
  validate: 
    func: t4
    files:
      aligned.log:
        num_reads: 1
        num_hits: 1
        num_fail: 0
        min_len: 1487
        max_len: 1487
    idx_sfx_win: 7828442710921335713
    idx_sfx_lin: 12011197668640222139
    num_idx: 7 # 7 index files of each kind is generated

t5:
  name: test_mate_pairs - part 1
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -max_pos
    - '250'
    - -fastx
    - -other
    - -v
    - -threads
    - '5'
    #- -pid
  validate:
    func:
    files:
      aligned.log:
        num_reads:  10000
        num_hits:    6000
        num_fail:    4000
      aligned.fq.gz: 6000
      other.fq.gz:   4000
    variant:    sanger # fastq quality variant

t6:
  name: test_mate_pairs - part 2 - paired_in
  info: |
    -e      min_sw  hits
     1          49  6000
     0.001      59  6000
     1e-7       74  6000
     1e-12      93  6000
     1e-15     105  6000
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_1.fastq # 5,000 reads
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_2.fastq # 5,000 reads
    - -max_pos
    - '250'
    - -fastx
    - -other
    - -paired_in
    - -blast
    - '1 cigar qcov'
    - -v
    - -e
    - '0.01'
    - -threads
    - '4'
  validate:
    func:
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   6000
        num_fail:   4000
      aligned.blast:
        num_recs:   6000
        n_yid_ycov: 5623
        n_yid_ncov:
        n_nid_ycov:
        n_denovo:    # num_pass_id ⋂ num_pass_cov
      aligned.fq:  10000  # paired_in
      other.fq:         0
      pid_pcov.blast:   # n_yid_ycov 5623  debug file
    variant: sanger # fastq quality variant

t7:
  name: test_mate_pairs - part 3 - paired_out
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_1.fastq # 5,000 reads
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_2.fastq # 5,000 reads
    - -max_pos
    - '250'
    - -fastx
    - -other
    - -paired_out
    - -v
  validate:
    func:
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   6000
        num_fail:   4000
      aligned.fq:   2000  # paired_out
      other.fq:     8000
    variant: sanger # fastq quality variant

t8:
  name: test_multiple_databases_search
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ SMR_SRC }}/data/set7_arc_bac_16S_database_match.fasta # 6 reads
    - -fastx
    - -v
  validate:
    func:
    files:
      aligned.log:
        num_reads: 6
        num_hits:  4
        num_fail:  2
      aligned.fa:  4

t9:
  name: test_output_all_alignments_f_rc
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/ref_GQ099317_forward_and_rc.fasta
    - -reads
    - {{ SMR_SRC }}/data/illumina_GQ099317.fasta # 1 read
    - -num_alignments
    - '0'
    - -sam
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - '1'
  validate:
    func: t9
    num_reads: 1
    num_hits:  1
    num_fail:  0
    sam_alignments_expected: [
      [
          'GQ099317.1.1325_157_453_0:0:0_0:0:0_99/1',
          '0',
          'GQ099317.1.1325_157_453_0:0:0_0:0:0_99/1',
          '1',
          '255',
          '101M',
          '*',
          '0',
          '0',
          'GCTGGCACGGAGTTAGCCGGGGCTTATAAATGGTACCGTCATTGATTCTTCCCATTCTTTCGAAGTTTACATCCCGAGGGACTTCATCCTTCACGCGGCGT',
          '*',
          'AS:i:202',
          'NM:i:0'
      ],
      [
          'GQ099317.1.1325_157_453_0:0:0_0:0:0_99/1',
          '16',
          'GQ099317.1.1325_157_453_0:0:0_0:0:0_99/1',
          '102',
          '255',
          '101M',
          '*',
          '0',
          '0',
          'ACGCCGCGTGAAGGATGAAGTCCCTCGGGATGTAAACTTCGAAAGAATGGGAAGAATCAATGACGGTACCATTTATAAGCCCCGGCTAACTCCGTGCCAGC',
          '*',
          'AS:i:202',
          'NM:i:0'
      ]
    ]

t10:
  name: test_ref_shorter_than_seed
  note: |
    This captures the output of the command and verifies the error message.
    No output files are produced
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/ref_short_seqs.fasta
    - -reads
    - {{ SMR_SRC }}/data/illumina_GQ099317.fasta # 1 read
    - -v
    - -workdir
    - {{ WRK_DIR }}
  cwd:
  capture: True
  validate:
    func: t10
    err_msg: 'one of your sequences is shorter than the seed length 19'

t11:
  name: test_simulated_amplicon_1_part_map
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set5_simulated_amplicon_silva_bac_16s.fasta
    - -id
    - '0.97'
    - -coverage
    - '0.97'
    - -otu_map
    - -de_novo_otu
    - -blast
    - '1 cigar qcov'
    - -fastx
    - -other
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - '3'
  validate:
    func:
    files:
      aligned.log:
        num_reads:  30000
        num_hits:   19995
        num_fail:   10005
        n_denovo:    1691  # 9831
        n_yid_ycov: 10164 # 10164 + 9831 = 19995  pass_SW + pass_ID, not necessarily pass_Cov
        num_groups:  4401
      aligned.blast:
        num_recs:   19995
        n_yid_ycov: 10164 # pass_SW + pass_ID + pass_Cov
        n_nid_ycov:  8122
        n_yid_ncov:    11
        n_denovo:    1691
        n_pass_id:  10175 # yid_ycov + yid_ncov
        n_pass_cov: 15054
      aligned.fa:   19995
      other.fa:     10005
      aligned_denovo.fa:
      otu_map.txt:   4401

t12:
  name: test_simulated_amplicon_1_part_map
  note: same as t11 + 'best 5'
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set5_simulated_amplicon_silva_bac_16s.fasta
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -otu_map
    - -de_novo_otu
    - -other
    - -id
    - '0.97'
    - -coverage
    - '0.97'
    - -v
    - -threads
    - {{THREADS or '\'5\''}}
    - -workdir
    - {{ WRK_DIR }} # have to use on AWS SSM where HOME is not set
  validate:
    func:
    files:
      aligned.log:
        num_reads:  30000
        num_hits:   19995
        num_fail:   10005
        n_yid_ycov: 10164
        n_denovo:    1691
        num_groups : 4401
        min_sw:        49
      aligned.blast:
        num_recs:   19995 # num_pass_id_cov + num_denovo + num_y_id_n_cov + num_n_id_y_cov = 19995 = num_hits
        n_yid_ycov: 10164 # num_pass_id ⋂ num_pass_cov
        n_yid_ncov:    11 # ID + !COV
        n_nid_ycov:  8122 # !ID + COV
        n_denovo:    1691 # !ID + !COV 
      aligned.fa:   19995
      other.fa:     10005
      otu_map.txt:   4401
      aligned_denovo.fa:  # debug
      pid_pcov.blast:     # debug

t13:
  name: test_simulated_amplicon_6_part_map
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set5_simulated_amplicon_silva_bac_16s.fasta
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -otu_map
    - -de_novo_otu
    - -other
    - -id
    - '0.97'
    - -coverage
    - '0.97'
    # indexing options
    - -m
    - '20'
    - -v
    - -threads
    - {{THREADS or '\'5\''}}
  validate:
    func:
    files:
      aligned.log:
        num_reads:      30000
        num_hits:       19995
        num_fail:       10005
        n_denovo:        1691
        n_yid_ycov:     10164
        num_groups:      4401
      aligned.blast:
        num_recs:       19995
        n_yid_ycov:     10164 # pass_SW + pass_ID + pass_Cov
        n_yid_ncov:        11
        n_nid_ycov:      8122
        n_denovo:        1691
        n_yid:          10175   
        n_ycov:         15054 
      aligned.fa:       19995
      other.fa:         10005
      aligned_denovo.fa: 1691
      otu_map.txt:       4401

t14:
  name: test_simulated_amplicon_12_part_map
  note: identical to t13 except using 12-part index instead of 6-part
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ SMR_SRC }}/data/set5_simulated_amplicon_silva_bac_16s.fasta
    - -id
    - '0.97'
    - -coverage
    - '0.97'
    - -otu_map
    - -de_novo_otu
    - -blast
    - '1 cigar qcov'
    - -fastx
    - -other
    # indexing options
    - -m
    - '10'
    - -v
    - -workdir
    - {{ WRK_DIR }}
  validate:
    func:
    files:
      aligned.log:
        num_reads:      30000
        num_hits:       19995
        num_fail:       10005
        n_denovo:        1691
        n_yid_ycov:     10164 # 10164 + 9831 = 19995, pass_ID + pass_Cov, not necessarily pass_SW
        num_groups:      4401 # 4400 before bug 52
      aligned.fa:       19995
      other.fa:         10005
      aligned_denovo.fa: 1691
      otu_map.txt:       4401
      aligned.blast:
        num_recs:       19995
        n_yid_ycov:     10164 # pass_SW + pass_ID + pass_Cov
        n_pass_id:      10175 
        n_pass_cov:     15054 
        n_denovo:        1691

t15:
  name: test_threads
  info: |
    ref  reads  best  N  min_lis zip
    ---------------------------------
    1    2      true  1  2       true
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq.gz # 5,000 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq.gz # 5,000 reads
    - -threads
    - '6:2:2' # can be any 6 | 6:2 | 6:2:2
    - '-a' # deprecated. Redirects to 'threads'
    - '5'
    - -v
    - -workdir
    - {{ WRK_DIR }}
  validate:
    func:
    files:
      aligned.log:
        num_reads:     10000
        num_hits:       9833
        num_fail:        167
      aligned.blast.gz: 
        num_recs:       9833

t16:
  name: 2 read + zip + 1 best
  info: |
    refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2     1    1       -        -       -     -     -      -

    best  N  min_lis seeds
    ----------------------  alignment type
      1   1     2      2
  note:
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq.gz # 5,000 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq.gz # 5,000 reads
    - -fastx
    - -blast
    - '1'
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:  10000
        num_hits:    9833
        num_fail:     167
      aligned.blast.gz:
        num_recs:    9833
        n_yid_ycov:   0 
        n_yid_ncov: 0 
        n_nid_ycov: 0 
        n_denovo:  0
      aligned.fq.gz: 9833
      pid_pcov.blast:   # debug


t16_2:
  name: 2 read + zip + all + relative paths
  info: |
    refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2     1    1       -        -       -     -     -      -

    best  N  min_lis seeds
    ----------------------  alignment type
      1   0     2      2
  note:
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq.gz # 5,000 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq.gz # 5,000 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -num_alignments
    - '0'
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger
    files:
      aligned.log:
        num_reads:  10000
        num_hits:    9833
        num_fail:     167
      aligned.blast.gz:
        num_recs:  370707 # ~37 alignments per read
        n_yid_ycov:   905 
        n_yid_ncov: 26656 
        n_nid_ycov: 66130 
        n_denovo:  277016
      aligned.fq.gz: 9833

t16_3:
  name: 2 reads + zip + 2 best + relative paths
  info: |
    refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2     1    1       -        -       -     -     -      -

    best  N  min_lis seeds
    ----------------------  alignment type
      1   2     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq.gz # 5,000 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq.gz # 5,000 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -num_alignments
    - '2'
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger
    files:
      aligned.log:
        num_reads:  10000
        num_hits:    9833
        num_fail:     167
      aligned.blast.gz:
        num_recs:   19638 
        n_yid_ycov:   816 
        n_yid_ncov:   201 
        n_nid_ycov: 11555 
        n_denovo:    7066
      aligned.fq.gz: 9833
      pid_pcov.blast:

t16_4:
  name: 2 reads + zip + 1 no best + relative paths
  info: |
    refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2     1    1       -        -       -     -     -      -

    best  N  min_lis seeds
    ----------------------  alignment type
      0   1     2      2
  note:
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq.gz # 5,000 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq.gz # 5,000 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -no-best
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger
    files:
      aligned.log:
        num_reads:  10000
        num_hits:    9833
        num_fail:     167
      aligned.blast.gz:
        num_recs:    9833 # 1 alignment per read 
        n_yid_ycov:    70 
        n_yid_ncov:   224 
        n_nid_ycov:  3518 
        n_denovo:    6021
      aligned.fq.gz: 9833

t16_5:
  name: 2 reads + zip + 2 no best + relative paths
  info: |
    refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2     1    1       -        -       -     -     -      -

    best  N  min_lis seeds
    ----------------------  alignment type
      0   2     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq.gz # 5,000 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq.gz # 5,000 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -no-best
    - -num_alignments
    - '2'
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger
    files:
      aligned.log:
        num_reads:  10000
        num_hits:    9833
        num_fail:     167
      aligned.blast.gz:
        num_recs:   19637
        n_yid_ycov:   697 
        n_yid_ncov:   503 
        n_nid_ycov:  8321 
        n_denovo:   10116
      aligned.fq.gz: 9833

t16_6:
  name: 2 reads + zip + 1 best + out2 + relative paths
  info: |
    refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2     1    1       -        -       1     -     -      -

    best  N  min_lis seeds
    ----------------------  alignment type
      1   1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq.gz # 5,000 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq.gz # 5,000 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -out2
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger
    files:
      aligned.log:
        num_reads:  10000
        num_hits:    9833
        num_fail:     167
      aligned.blast.gz:
        num_recs:    9833
        n_yid_ycov:   667 
        n_yid_ncov:    70 
        n_nid_ycov:  6143 
        n_denovo:    2953
      aligned_fwd.fq.gz: 4876
      aligned_rev.fq.gz: 4957
      pid_pcov.blast:   # debug

t16_7:
  name: 2 reads + zip + 1 best + sout + relative paths
  info: |
    refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2     1    1       -        -       -     1     -      -

    best  N  min_lis seeds
    ----------------------  alignment type
      1   1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq.gz # 5,000 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq.gz # 5,000 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -sout
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   9833
        num_fail:    167
      aligned.blast.gz:
        num_recs:   9833
        n_yid_ycov:  667 
        n_yid_ncov:   70 
        n_nid_ycov: 6143 
        n_denovo:   2953
      aligned_paired.fq.gz:   9730
      aligned_singleton.fq.gz: 103

t16_8:
  name: 2 reads + zip + 1 best + out2 + sout + relative paths
  info: |
    refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2     1    1       -        -       1     1     -      -

    best  N  min_lis seeds
    ----------------------  alignment type
      1   1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq.gz # 5,000 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq.gz # 5,000 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -sout
    - -out2
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    zip: True  # output is gzipped
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:   10000
        num_hits:     9833
        num_fail:      167
      aligned_paired_fwd.fq.gz:    4865
      aligned_paired_rev.fq.gz:    4865
      aligned_singleton_fwd.fq.gz:   11
      aligned_singleton_rev.fq.gz:   92
      aligned.blast.gz:
        num_recs:   9833
        n_yid_ycov:  667 
        n_yid_ncov:   70 
        n_nid_ycov: 6143 
        n_denovo:   2953

t16_9:
  name: 2 reads + zip + 1 best + out2 + sout + other + relative paths
  info: |
    refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2     1    1       -        -       1     1     1      1

    best  N  min_lis seeds
    ----------------------  alignment type
      1   1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq.gz # 5,000 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq.gz # 5,000 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -sout
    - -out2
    - -other
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   9833
        num_fail:    167
      aligned.blast.gz:          
        num_recs:   9833
        n_yid_ycov: 667 
        n_yid_ncov: 70 
        n_nid_ycov: 6143 
        n_denovo:   2953
      aligned_paired_fwd.fq.gz:  4865
      aligned_paired_rev.fq.gz:  4865
      aligned_singleton_fwd.fq.gz: 11
      aligned_singleton_rev.fq.gz: 92
      other_paired_fwd.fq.gz:      32
      other_paired_rev.fq.gz:      32
      other_singleton_fwd.fq.gz:   92
      other_singleton_rev.fq.gz:   11

t17:
  name: test_indexing
  info: |
    test indexing, workdir
    ref  reads  best   N  min_lis zip
    ----------------------------------
    8    2      true   1  2       true
  cmd:
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-18s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-16s-id90.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-16s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5s-database-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5.8s-database-id98.fasta
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - {{ SMR_SRC }}/data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - {{THREADS or '\'8\''}}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   5944
        num_fail:   4056
      aligned.blast.gz:
        num_recs: 5944
        n_yid_ycov: 0 
        n_yid_ncov: 0 
        n_nid_ycov: 0 
        n_denovo: 0

t18:
  name: 2 paired reads files + paired_in + joint FWD/REV output
  info: |
    Test the new option '-out2' (issue 202)
    Test different E-values
    ...                               paired_in
    -e      min_sw  hits  2*hits   aligned   other
     1          48  9188
     0.001      60  8956
     1e-7       75  7919    
     1e-12      95  6501    
     1e-15     106  5307    
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    #- -out2
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - {{THREADS or '\'4\''}}
    - -dbg-level
    - {{DBG_LEVEL or '\'0\''}}
    - -task
    - {{TASK or '\'4\''}}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   9188
        num_fail:    812
      aligned.blast:
        num_recs:   9188
      aligned.fq:   9852  # paired_in
      other.fq:      148

t18_1:
  name: 2 paired reads files + paired_in + joint FWD/REV output
  info: |
    the same as t18 but using plain Fasta instead of Fastq
    Test the new option '-out2' (issue 202)
    Test different E-values
    ...                               paired_in
    -e      min_sw  hits  2*hits   aligned   other
     1          48  9188
     0.001      60  8956
     1e-7       75  7919    
     1e-12      95  6501    
     1e-15     106  5307    
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fa # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fa # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    #- -out2
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - {{THREADS or '\'4\''}}
    - -dbg-level
    - {{DBG_LEVEL or '\'0\''}}
    - -task
    - {{TASK or '\'4\''}}
  validate:
    func:
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   9188
        num_fail:    812
      aligned.blast:
        num_recs:   9188
      aligned.fa:   9852  # paired_in
      other.fa:      148

t18_2:
  name: 2 paired reads files + paired_in + joint FWD/REV output
  info: |
    the same as t18_1 but using plain Fasta with NO NL at the end
    Test the new option '-out2' (issue 202)
    Test different E-values
    ...                               paired_in
    -e      min_sw  hits  2*hits   aligned   other
     1          48  9188
     0.001      60  8956
     1e-7       75  7919    
     1e-12      95  6501    
     1e-15     106  5307    
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k_nnl.fa # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k_nnl.fa # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    #- -out2
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - {{THREADS or '\'4\''}}
    - -dbg-level
    - {{DBG_LEVEL or '\'0\''}}
    - -task
    - {{TASK or '\'4\''}}
  validate:
    func:
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   9188
        num_fail:    812
      aligned.blast:
        num_recs:   9188
      aligned.fa:   9852  # paired_in
      other.fa:      148

t18_3:
  name: 2 paired reads files + paired_in + joint FWD/REV output
  info: |
    the same as t18_1 but using gzipped Fasta with NL at the end
    Test the new option '-out2' (issue 202)
    Test different E-values
    ...                               paired_in
    -e      min_sw  hits  2*hits   aligned   other
     1          48  9188
     0.001      60  8956
     1e-7       75  7919    
     1e-12      95  6501    
     1e-15     106  5307    
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fa.gz # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fa.gz # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    #- -out2
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - {{THREADS or '\'4\''}}
    - -dbg-level
    - {{DBG_LEVEL or '\'0\''}}
    - -task
    - {{TASK or '\'4\''}}
  validate:
    func:
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   9188
        num_fail:    812
      aligned.blast.gz:
        num_recs:   9188
      aligned.fa.gz:   9852  # paired_in
      other.fa.gz:      148

t18_4:
  name: 2 paired reads files + paired_in + joint FWD/REV output
  info: |
    the same as t18_1 but using gzipped Fasta with No NL at the end
    Test the new option '-out2' (issue 202)
    Test different E-values
    ...                               paired_in
    -e      min_sw  hits  2*hits   aligned   other
     1          48  9188
     0.001      60  8956
     1e-7       75  7919    
     1e-12      95  6501    
     1e-15     106  5307    
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k_nnl.fa.gz # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k_nnl.fa.gz # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    #- -out2
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - {{THREADS or '\'4\''}}
    - -dbg-level
    - {{DBG_LEVEL or '\'0\''}}
    - -task
    - {{TASK or '\'4\''}}
  validate:
    func:
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   9188
        num_fail:    812
      aligned.blast.gz:
        num_recs:   9188
      aligned.fa.gz:   9852  # paired_in
      other.fa.gz:      148

t19:
  name: 2 reads + paired_in
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2      1        1           -         -     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2

    Test the new option '-out2' (issue 202)
    ...                               paired_in
    -e      min_sw  hits  2*hits   aligned   other
     1          48  9188
     0.001      60  8956
     1e-7       75  7919    
     1e-12      95  6501    
     1e-15     106  5307    
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    #- -out2
    - -threads
    - {{THREADS or '\'4\''}}
  validate:
    func:
    variant:        sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   9833
        num_fail:    167
      aligned.blast:
        num_recs: 9833
      aligned.fq: 9936
      other.fq:     64
    runtime:
      win:
        - threads: 8
          sec: [1.24292, 0.322213, 0.566375] # align, log, reports

t19_1:
  name: 2 reads + paired_in + out2
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2      1        1           -         1     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2 
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    - -out2
    - -threads
    - {{THREADS or '\'4\''}}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:   10000
        num_hits:     9833
        num_fail:      167
      aligned.blast:
        num_recs:     9833
      aligned_fwd.fq: 4968
      aligned_rev.fq: 4968
      other_fwd.fq:     32
      other_rev.fq:     32
    runtime:
      win:
        - threads: 8
          sec: [1.24292, 0.322213, 0.566375] # align, log, reports

t19_2:
  name: 2 reads + paired_out
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2      1        -           1         -     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2 
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_out
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   9833
        num_fail:    167
      aligned.blast:
        num_recs:   9833
      aligned.fq:   9730  # paired_out
      other.fq:      270
    runtime:
      win:
        - threads: 8
          sec: [1.24292, 0.322213, 0.566375] # align, log, reports

t19_3:
  name: 2 reads + paired_out + out2
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2      1        -           1         -     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_out
    - -out2
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:   10000
        num_hits:     9833
        num_fail:      167
      aligned.blast:
        num_recs:     9833
      aligned_fwd.fq: 4865
      aligned_rev.fq: 4865
      other_fwd.fq:    135
      other_rev.fq:    135
    runtime:
      win:
        - threads: 8
          sec: [1.24292, 0.322213, 0.566375] # align, log, reports

t19_4:
  name: 2 reads + out2
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      2      1        -           -         -     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -out2
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:   10000
        num_hits:     9833
        num_fail:      167
      aligned.blast:
        num_recs:     9833
      aligned_fwd.fq: 4876
      aligned_rev.fq: 4957
      other_fwd.fq:    124
      other_rev.fq:     43
    runtime:
      win:
        - threads: 8
          sec: [1.24292, 0.322213, 0.566375] # align, log, reports

t19_5:
  name: 2 reads no zip + out2 + zip out
  info: |
    refs  reads  zip  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------------ output type
     2      2     0     1        -           -         1     -     1    0

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -blast
    - '1'
    - -out2
    - -zip-out
    - '1'
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:   10000
        num_hits:     9833
        num_fail:      167
      aligned.blast:
        num_recs:     9833
      aligned_fwd.fq: 4876
      aligned_rev.fq: 4957
    runtime:
      win:
        - threads: 8
          sec: [1.24292, 0.322213, 0.566375] # align, log, reports

t20:
  name: 1 reads + paired_in
  info: |
    Test the new option '-out2' (issue 202)

    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     2      1      1        1           -         -     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - {{THREADS or '\'4\''}}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   9833
        num_fail:    167
      aligned.blast:
        num_recs:   9833
      aligned.fq:   9936
      other.fq:       64

t20_1:
  name: 1 reads + paired_in + out2
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     1      1      1        1           -         1     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -out2
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:   10000
        num_hits:     9833
        num_fail:      167
      aligned.blast:
        num_recs:     9833
      aligned_fwd.fq: 4968
      aligned_rev.fq: 4968
      other_fwd.fq:     32
      other_rev.fq:     32

t20_2:
  name: 1 reads + paired_out
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     1      1      1        -           1         -     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_out
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   9833
        num_fail:    167
      aligned.blast:
        num_recs:   9833
      aligned.fq:   9730
      other.fq:      270

t20_3:
  name: 1 reads + paired_out + out2
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     1      1      1        -           1         1     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_out
    - -out2
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:   10000
        num_hits:     9833
        num_fail:      167
      aligned.blast:
        num_recs:     9833
      aligned_fwd.fq: 4865
      aligned_rev.fq: 4865
      other_fwd.fq:    135
      other_rev.fq:    135

t20_4:
  name: 1 reads + paired + out2
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     1      1      1        -           0         1     -     -    1

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired
    - -out2
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:   10000
        num_hits:     9833
        num_fail:      167
      aligned.blast:
        num_recs:     9833
      aligned_fwd.fq: 4876
      aligned_rev.fq: 4957
      other_fwd.fq:    124
      other_rev.fq:     43

t21:
  name: single paired reads file + paired_in + separate FWD/REV output
  note: |
    Same as test 20 + 'out2' option
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -paired_in
    - -v
    - -out2
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:   10000
        num_hits:     9188
        num_fail:      812
      aligned.blast:
        num_recs:     9188
      aligned_fwd.fq: 4926
      aligned_rev.fq: 4926
      other_fwd.fq:     74
      other_rev.fq:     74

t22:
  name: single paired reads file + joint FWD/REV output
  note: |
    Test the new option '-out2' (issue 202)
    ...                               paired_in 
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -v
    - -out2
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   9188
        num_fail:    812
      aligned.blast:
        num_recs:   9188
      aligned.fq:   9188
      other.fq:      812

t23:
  name: single paired reads file + separate FWD/REV output
  note: |
    Same as 22 but FWD and REV output to different files
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -v
    - -paired
    - -out2
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:   10000
        num_hits:     9188
        num_fail:      812
      aligned.blast:
        num_recs:     9188
      aligned_fwd.fq: 4281
      aligned_rev.fq: 4907
      other_fwd.fq:    719
      other_rev.fq:     93

t24:
  name: 1 paired reads file + joint FWD/REV output
  note: |
    Same as 22 but 'paired' is used without 'out2' => FWD and REV output to the same files
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_5k_paired.fastq # 10,000 reads: Mouse gut metagenome of 16S rRNA
    - -fastx
    - -other
    - -blast
    - '1'
    - -v
    - -paired
  validate:
    func:
    variant:     sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   9188
        num_fail:    812
      aligned.blast:
        num_recs:   9188
      aligned.fq:   9188
      other.fq:      812

t25:
  name: test_aligned_opt
  note: |
    ref  reads  best  N  min_lis
    ---------------------------
    2    2 gz   true  1  2

    test '-aligned' option with custom prefix
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -fastx
    - -aligned
    - out1/out2/set4
    - -other
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   6000
        num_fail:   4000
      set4.log:          # $PWD/out1/out2/set4.log
        num_reads: 10000
        num_hits:   6000
        num_fail:   4000
      set4.fq.gz:   6000 # aligned  $PWD/out1/out2/set4.fq.gz
      other.fq.gz:  4000 # other    $PWD/out1/out2/other.fq.gz

t26:
  name: test_output_opt
  note: |
    Options and their combinations to test:
    -workdir
    -kvdb
    -idx
    -aligned
    -other
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -kvdb
    - run/kvdb_1
    - -idx-dir
    - run/idx_1
    - -fastx
    - -aligned
    - run/out_1/set4_aligned
    - -other
    - run/out_1/set4_other
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   6000
        num_fail:   4000
      set4_aligned.log:
        num_reads: 10000
        num_hits:   6000
        num_fail:   4000
      set4_aligned.fq.gz: 6000 # $PWD/run/out_1/set4_aligned.fq.gz
      set4_other.fq.gz:   4000 # $PWD/run/out_1/set4_other.fq.gz

t27:
  name: test_output_opt_other_bool
  note: |
    Options and their combinations to test:
    -workdir
    -kvdb
    -idx
    -aligned
    -other
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -kvdb
    - run/kvdb_1
    - -idx-dir
    - run/idx_1
    - -fastx
    - -aligned
    - run/out_1/set4_aligned
    - -other
    - -workdir
    - {{ WRK_DIR }}
    - -v
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   6000
        num_fail:   4000
      set4_aligned.log:
        num_reads: 10000
        num_hits:   6000
        num_fail:   4000
      set4_aligned.fq.gz: 6000 # $PWD/run/out_1/set4_aligned.fq.gz
      other.fq.gz:        4000 # $PWD/run/out_1/other.fq.gz

t28:
  name: test_output_opt_aligned_bool_other_bool
  note: |
    Options and their combinations to test:
    -workdir
    -kvdb
    -idx
    -aligned
    -other
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -kvdb
    - run/kvdb_1
    - -idx-dir
    - run/idx_1
    - -fastx
    - -aligned
    - run/out_1/
    - -other
    - -v
    - -workdir
    - {{WRK_DIR}}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:  10000
        num_hits:    6000
        num_fail:    4000
      aligned.fq.gz: 6000 # $PWD/run/out_1/aligned.fq.gz
      other.fq.gz:   4000 # $PWD/run/out_1/other.fq.gz

t29:
  name: test_output_opt_no_workdir
  note: |
    Options and their combinations to test:
    -kvdb
    -idx
    -aligned 'no file name' -> use default 'aligned'
    -other   'boolean' -> to be placed in the same location as aligned output
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -v
    - -kvdb
    - run/kvdb_1
    - -idx-dir
    - run/idx_1
    - -fastx
    - -aligned
    - run/out_1/
    - -other
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 10000
        num_hits:   6000
        num_fail:   4000
      aligned.fq.gz: 6000 # $PWD/run/out_1/aligned.fq.gz
      other.fq.gz:   4000 # $PWD/run/out_1/other.fq.gz

t30:
  name: test_output_opt_no_workdir_no_idx
  note: |
    Options and their combinations to test:
     no workdir
     no idx
    -kvdb
    -aligned 'no file name' -> use default 'aligned'
    -other   'boolean' -> to be placed in the same location as aligned output
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -v
    - -kvdb
    - run/kvdb_1
    - -fastx
    - -blast
    - -aligned
    - run/out/
    - -other
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:  10000
        num_hits:    6000
        num_fail:    4000
      aligned.blast.gz:
        num_recs:    6000
      aligned.fq.gz: 6000 # $PWD/run/out/aligned.fq.gz
      other.fq.gz:   4000 # $PWD/run/out/other.fq.gz


t31:
  name: test_output_opt_no_workdir_no_idx
  note: |
    Options and their combinations to test:
     no workdir
     no idx
    -kvdb
    -aligned 'no file name' -> use default 'aligned'
    -other   'boolean' -> to be placed in the same location as aligned output
  cmd:
    - -ref
    - data/silva-bac-16s-database-id85.fasta
    - -ref
    - data/silva-arc-16s-database-id95.fasta
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_1.fastq.gz # 5,000 reads
    - -reads
    - data/set4_mate_pairs_metatranscriptomics_2.fastq.gz # 5,000 reads
    - -v
    - -kvdb
    - run/kvdb_1
    - -fastx
    - -aligned
    - run/out/
    - -other
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:  10000
        num_hits:    6000
        num_fail:    4000
      aligned.fq.gz: 6000 # $PWD/run/out/
      other.fq.gz:   4000 # $PWD/run/out/

t32:
  name: 2 reads + no_best + N_1 + paired_in + out2 (separate FWD/REV output)
  note:
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -num_alignments
    - '1'
    - -no-best
    - -fastx
    - -other
    - -blast
    - '1 cigar qcov'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    - -out2
    - -workdir
    - {{ WRK_DIR }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:   10000
        num_hits:     9188
        num_fail:      812
      aligned.blast:
        num_recs:     9188
        n_yid_ycov:      0 
        n_yid_ncov:     21 
        n_nid_ycov:   1013
        n_denovo:     8154
      aligned_fwd.fq: 4926
      aligned_rev.fq: 4926
      other_fwd.fq:     74
      other_fwd.fq:     74
    runtime:
      win:
        - threads: 8
          sec: [0.743277, 0.348923, 0.672172] # align, log, reports
    memory:
      note: |
        only for alignment. 
        KB
        format: [loaded index, alignment done, unloaded index and refs]
      win: [145808, 162104, 50744]
      lnx: []

t33:
  name: 2 reads + best + N_1 + paired_in + out2 (separate FWD/REV output)
  note:
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -num_alignments
    - '1'
    - -fastx
    - -other
    - -blast
    - '1 cigar qcov'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    - -out2
    - -workdir
    - {{ WRK_DIR }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:   10000
        num_hits:     9188
        num_fail:      812
      aligned.blast:
        num_recs:     9188
        n_yid_ycov:      0 
        n_yid_ncov:     16 
        n_nid_ycov:   1032
        n_denovo:     8140
      aligned_fwd.fq: 4926
      aligned_rev.fq: 4926
      other_fwd.fq:     74
      other_rev.fq:     74
    runtime:
      win:
        - threads: 8
          sec: [0.743277, 0.348923, 0.672172] # align, log, reports
    memory:
      note: |
        only for alignment. 
        KB
        format: [loaded index, alignment done, unloaded index and refs]
      win: [145808, 162104, 50744]
      lnx: []

t34:
  name: 2 reads + best + N_3 + paired_in + out2 (separate FWD/REV output)
  note:
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -num_alignments
    - '3'
    - -fastx
    - -other
    - -blast
    - '1 cigar qcov'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    - -out2
    - -workdir
    - {{ WRK_DIR }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:   10000
        num_hits:     9188
        num_fail:      812
      aligned.blast:
        num_recs:    16701
        n_yid_ycov:      0 
        n_yid_ncov:     30 
        n_nid_ycov:   1128 
        n_denovo:    15543
      aligned_fwd.fq: 4926
      aligned_rev.fq: 4926
      other_fwd.fq:     74
      other_rev.fq:     74
    runtime:
      win:
        - threads: 8
          sec: [1.07325, 0.337265, 0.650805] # align, log, reports
    memory:
      note: |
        only for alignment. 
        KB
        format: [loaded index, alignment done, unloaded index and refs]
      win: [145808, 162104, 50744]
      lnx: []

t35:
  name: 2 reads + N_0 (all alignments) + paired_in + out2 (separate FWD/REV output)
  note:
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_1_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/DRR121111_2_5k.fastq # 5,000 reads: Mouse gut metagenome of 16S rRNA
    - -num_alignments
    - '0'
    - -fastx
    - -other
    - -blast
    - '1 cigar qcov'
    - -paired_in
    - -v
    #- -e
    #- '1e-15'
    - -out2
    - -workdir
    - {{ WRK_DIR }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:   10000
        num_hits:     9188
        num_fail:      812
      aligned.blast:
        num_recs:    47552
        n_yid_ycov:      0 
        n_yid_ncov:    113 
        n_nid_ycov:   1130 
        n_denovo:    46309
      aligned_fwd.fq: 4926
      aligned_rev.fq: 4926
      other_fwd.fq:     74
      other_rev.fq:     74
    time:
      win:
        - threads: 8
          sec: [1.07325, 0.337265, 0.650805] # align, log, reports
    memory:
      note: |
        only for alignment. 
        KB
        format: [loaded index, alignment done, unloaded index and refs]
      win: [145808, 162104, 50744]
      lnx: []


#
# custom tests
#
t36:
  name: Single reads file, 250 reads
  cmd:
  - -ref
  - {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta
  - -reads
  - {{ DATA_DIR if DATA_DIR }}/sortmerna/reads/ecoli100.1.head1000.fq
  - -num_alignments
  - '1'
  - -fastx
  - -v
  validate:
    func:
    variant: illumina1.8 # fastq quality variant
    files:
      aligned.log:
        num_reads: 250
        num_hits:   23
        num_fail:  227
      aligned.fq:   23

t37:
  name: Paired reads
  cmd:
  - -ref
  - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
  - -ref
  - {{ SMR_SRC }}/data/silva-arc-16s-database-id95.fasta
  - -reads 
  # SRR7721017_1.fastq | SRR7721017_1_100.fastq | SRR7721017_1_15.fastq
  - {{ DATA_DIR if DATA_DIR }}/sortmerna/reads/paired_reads_test/SRR7721017_1.fastq.gz # 20 MB  639240 reads
  - -reads
  # SRR7721017_2.fastq | SRR7721017_2_100.fastq | SRR7721017_2_15.fastq
  - {{ DATA_DIR if DATA_DIR }}/sortmerna/reads/paired_reads_test/SRR7721017_2.fastq.gz # 23 MB  639240 reads
  - -v
  - -fastx
  - -paired_in
  - -blast
  - '1 cigar qcov'
  - -sam
  - -threads
  - {{THREADS or '\'8\''}}
  - -workdir
  - {{ WRK_DIR }}
  validate:
    func:
    variant: sanger
    files:
      aligned.log:
        num_reads: 1278480
        num_hits:    66387
        num_fail:  1212093
      aligned.blast.gz:
        num_recs:    66387
        n_yid_ycov:   1879 
        n_yid_ncov:   8391 
        n_nid_ycov:  13840 
        n_denovo:    42277
      aligned.fq.gz: 108320 # paired_in
      aligned.sam.gz:

    read_len: [75, 75, 75] # min, max, avr
  time:
    win_8_16:
      host: Windows 10 + 8 CPUs + 16 GiB RAM
      total:
        4-2-0: []
        4-3-0: [24, 35, 1, 19] # ~80 sec
      index_stats_calc:  # sec

t38:
  name: Paired reads GZ 2 x 2 GB
  cmd:
  - -ref
  - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta # 12,734,464 ~12MB
  - -reads
  - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_1.fastq.gz # 2 GB 24,654,594 reads
  - -reads
  - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_2.fastq.gz # 2 GB 24,654,594 reads
  - -v
  - -blast
  - '1 cigar qcov'
  - -sam
  - -threads
  - {{THREADS or '\'8\''}}
  - -workdir
  - {{ WRK_DIR }}
  validate:
    func:
    variant: sanger
    files:
      aligned.log:
        num_reads: 49309188
        num_hits:    687225
        num_fail:  48621963
      aligned.blast.gz:
        num_recs:   687225
        n_yid_ycov:    201 
        n_yid_ncov: 502288 
        n_nid_ycov:   1222 
        n_denovo:   183514
      aligned.sam.gz:
  time:
    win_8_16:
      host: Windows 10 + 8 CPUs + 16GB RAM
      4-3-3:
      - threads: 8
        total:  # sec no indexing
        # indexing, read count, readfeed, align, summary, report
        totals: [ 0, 227, 2237, 1107, 1, 509]  # 20210520 seems unusually slow today

t39:
  name: issue 207
  info: |
    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     1      1      -        -           -         -     -     -    -
    
    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
    
    sortmerna -m 4096 -a 4 -L 8 --fastx --blast 1 --workdir test 
      --num_alignments 0 --ref /path/rRNA_index.fasta --reads test.fq --other test2_mir.fq
    sortmerna -m 4096 -a 4 -L 8 --fastx --blast 1 --workdir test 
      --best 0 --ref /path/rRNA_index.fasta --reads test.fq --other test2_mir.fq
    sortmerna -m 4096 -a 4 -L 10 --fastx --blast 1 --workdir test 
      --best 0 -min_lis 1 --ref /path/rRNA_index.fasta --reads test.fq --other test2_mir.fq
  cmd:
  - -ref
  - {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta # 
  - -reads
  - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/smr_iss_207_20200123_test.fq.gz #
  - -e
  - '100'
  - -fastx
  - -blast
  - '1'
  - -threads
  - {{THREADS or '\'8\''}}
  validate:
    func:
    variant: sanger
    files:
      aligned.log:
        num_reads: 15000000
        num_hits:    798426 #  5.32
        num_fail:  14201574 # 94.68
      aligned.blast.gz:
        num_recs:    798426
        n_yid_ycov:       0 
        n_yid_ncov:       0 
        n_nid_ycov:       0 
        n_denovo:         0
      aligned.fq.gz: 798426
  time:           
    win_8_16:
      host: Windows 10 + 8 CPUs + 16GB RAM
      4-3-3:
      - threads: 8
        total: 
        # indexing, read count, readfeed, align, summary, report
        totals: [ 0, 30, 202, 1546, 1, 132] # 20210521

t40:
  name: 5 selected reads on 8 refs
  info: |
    8 reference databases + 5 reads

    refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     8      2     0    1       -        -       1     1     1      0

    best  N  min_lis seeds
    ----------------------  alignment type
      1   1     2      2
  cmd:
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-18s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-16s-id90.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-16s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5s-database-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5.8s-database-id98.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_1_5.fastq # 5 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_2_5.fastq # 5 reads
    - -fastx
    - -other
    - -blast
    - '1 cigar qcov'
    - -out2
    - -sout
    - -v
    - -threads
    - {{THREADS or '\'4\''}}
    - -index
    - {{INDEX or '\'2\''}}  # 2 is the default
    - -workdir
    - {{ WRK_DIR }}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:  10
        num_hits:   10
        num_fail:    0
      aligned.blast:
        num_recs:   10
        n_yid_ycov:  0
        n_yid_ncov:  0
        n_nid_ycov:  0
        n_denovo:   10
      aligned_paired_fwd.fq:    5
      aligned_paired_rev.fq:    5
      #aligned_singleton_fwd.fq: 0
      #aligned_singleton_rev.fq: 0
      #other_paired_fwd.fq:      0
      #other_paired_rev.fq:      0
      #other_singleton_fwd.fq:   0
      #other_singleton_rev.fq:   0

t41:
  name: issue 231 8x1M
  info: |
    stress test - 8 reference databases + 1M reads

    refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     8      2     1    1       -        -       1     1     1      1

    best  N  min_lis seeds
    ----------------------  alignment type
      1   1     2      2
  cmd:
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-18s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-16s-id90.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-16s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5s-database-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5.8s-database-id98.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_1_2M.fq.gz # 40MB, 500,000 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_2_2M.fq.gz # 40MB, 500,000 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -out2
    - -sout
    - -other
    - -v
    - -threads
    - {{THREADS or '\'8\''}}
    - -index
    - {{INDEX or '\'2\''}}  # 2 is the default
    - -workdir
    - {{ WRK_DIR }}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 1000000
        num_hits:    49909
        num_fail:   950091
      aligned.blast:
        num_recs:    49909
        n_yid_ycov:    181
        n_yid_ncov:  33018
        n_nid_ycov:    494
        n_denovo:    16216
      aligned_paired_fwd.fq.gz:     24509
      aligned_paired_rev.fq.gz:     24509
      aligned_singleton_fwd.fq.gz:    435
      aligned_singleton_rev.fq.gz:    456
      other_paired_fwd.fq.gz:      474600
      other_paired_rev.fq.gz:      474600
      other_singleton_fwd.fq.gz:      456
      other_singleton_rev.fq.gz:      435
  time:
    win_8_16:
      host: Windows 10 + 8 CPUs + 16 GiB RAM
      4-2-0:
        threads: 8
        tot: 225 # sec - ~4min - no indexing
        align: [ 15, 16, 18, 21, 11, 13, 13, 11 ]
      4-3-1: 
        threads: 8
        total: 391 # sec  ~7min
        # indexing, read count, split, idx stats, align, summary, report
        totals: [ 216, 3, 31, 3, 88, 3, 47 ]
        align:  [ 11, 12, 16, 18, 6, 8, 9, 6 ] # sec
    ubuntu18_vbox:
      host: Windows 10 + 8 CPUs + 16 GiB RAM
      4-3-1:
        threads: 4
        total:
        totals: [ 0, 5, 0, 4, 127, 4, 25]
        align:
    ubuntu18_4_16_32:
      host: AWS t3.xlarge + Ubuntu 18 + 4 cpu + 16 GB RAM + 32 GB HD
      4-2-0:
        total: 315 # sec - python trace from command sent to response received
        align: [  29, 29, 32, 35, 16, 19, 23, 16 ] # sec
      4-3-1:
        total: 502 # as returned by aws.py
        # indexing, read count, split, idx stats, align, summary, report
        totals: [ 221, 4, 58, 5, 141, 5, 29 ]
        align:  [ 23, 22,25, 27, 9, 11, 1, 8 ] # sec
    ubuntu18_8_16_32: #  c5.2xlarge 
      host: c5.2xlarge  cpu:8 ram:16  Intel Xeon Platinum 8000 compute optimized  AWS
      instance.create: 24 # sec
      smr.install:     113 # sec  aws.yaml:sortmerna.env.install
      4-3-1:
        - threads: 4
          date: 20210307 Sun
          total: 379 # as returned by aws.py
          # indexing, read count, split, idx stats, align, summary, report
          totals: [ 191, 3.6, 57, 4.1, 95, 4.1, 17]
          aws.cmd.id: 11df892b-85e2-4f05-9ba3-1c5691e140da
          aws.trace: {{ DATA_DIR }}/logs/aws/ssm/ubuntu18_8_16_32_t41_th4_20210307_0941.stdout
          aws.yaml: sortmerna.data.load:t41,sortmerna.test.run
        - threads: 8
          total: 160 # no indexing
          totals: [ 191, 3.6, 57, 4.1, 65, 4.1, 15]
          aws.cmd.id: 0973e4a5-17f6-41cf-a259-fc8988477969
          aws.trace: {{ DATA_DIR }}/logs/aws/ssm/ubuntu18_8_16_32_t41_th8_20210307_0946.stdout
          date: 20210307 Sun
    ubuntu18_8_32_32:
      threads: 8
      host: AWS t3.2xlarge + Ubuntu 18 + 8 cpu + 32 GB RAM + 32 GB HD
      4-2-1:
        total: 248 # sec as returned by aws.py
        reads_stats_calc: [1.65, 1.64, ]
        index_stats_calc: [4.66, ]
        # alignment cpu load: [ max,   min,  avr]
        cpu_load_align: [768, 534,    ] # all cores working
        align: [  18, 19, 17, 19, 11, 13, 15, 11 ] # sec
      4-3-1:
        threads: 8
        total:
        # indexing, read count, split, idx stats, align, summary, report
        totals: []
        align:
    ubuntu18_16_32_32:
      host:  c5.4xlarge  cpu:16 ram:32  Intel Xeon Platinum 8000  compute optimized
      instance.create: 27 # sec
      smr.install:    113 # sec  aws.yaml:sortmerna.env.install
      4-3-1:
        - threads: 8
          total: 297 # as returned by aws.py, includes indexing, data load
          # indexing, read count, split, idx stats, align, summary, report
          totals: [ 170, 3.4, 54, 4.1, 45, 4.1, 11 ]
          aws.cmd.id: 3a6e7afb-057c-4a1d-a438-3f23e7d49dc0
          aws.trace: {{ DATA_DIR }}/logs/aws/ssm/ubuntu18_16_32_32_t41_th8_20210307_1023.stdout
          aws.yaml: sortmerna.data.load:t41,sortmerna.test.run
        - threads: 16
          total: 113 # no indexing
          totals: [ 170, 3.4, 54, 4.1, 32, 4.1, 10 ]
          aws.cmd.id: 7655c85c-2060-423e-9d3c-c23301c422d8
          aws.trace: {{ DATA_DIR }}/logs/aws/ssm/ubuntu18_16_32_32_t41_th16_20210307_1027.stdout
    ubuntu18_16_64_32:
      host: AWS m5.4xlarge + Ubuntu 18 + 16 cpu + 64 GB RAM + 32 GB HD
      4-2-1:
        # alignment cpu load: [ max,   min,  avr]
        cpu_load_align:       [1540, 897.7,    ] 
        total: 507.63 # sec - python trace from command sent to response received - with indexing
        reads_stats_calc: [1.63729, 1.63938, ]
        index_stats_calc: [4.62, ]
        align: [ 12, 12, 13, 13, 7, 8, 8, 7 ] # sec per index part
    ubuntu18_32_128_32:
      # ~10 min to setup the instance and run the test: 1.536 / 6 = 0.256 per test
      host: AWS m5.8xlarge + Ubuntu 18 + 32 cpu + 128 GB RAM + 32 GB HD
      # alignment cpu load: [ max,   min,  avr]
      cpu_load_align:       [] 
      total: 485.936 # sec - python trace from command sent to response received - with indexing
      reads_stats_calc: [4.51]
      index_stats_calc: [ ]
      align: [ 8, 8, 8, 9, 5, 6, 6, 6] # sec
  memory:
    prior_idx_load: []
    idx_load:       []
    ref_load:       []
    align_done:     []
    idx_ref_unloaded:

t42:
  name: issue 231 8x10M
  info: |
    stress test - 8 reference databases + 10M reads

    refs  reads  zip  pair  pair_in  pair_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     8      2     1    1       -        -       1     1     1      0

    best  N  min_lis seeds
    ----------------------  alignment type
      1   1     2      2
  cmd:
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-18s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-16s-id90.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-16s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5s-database-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5.8s-database-id98.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_1_20M.fastq.gz # 5M reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_2_20M.fastq.gz # 5M reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -out2
    - -sout
    - -v
    - -threads
    - {{THREADS or '\'8\''}}
    - -index
    - {{INDEX or '\'2\''}}  # 2 is the default
    - -workdir
    - {{ WRK_DIR }}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 10000000 # 10M
        num_hits:    520127 #  5.2%
        num_fail:   9479873 # 94.8%
        num_hits_db:
          euk_28s_id98: 0.52
          euk_18s_id95: 0.02
          bac_23s_id98: 3.25
          bac_16s_id90: 1.37
          arc_23s_id98: 0
          arc_16s_id95: 0
          nc_5s_id98:   0.04  # non-coding - RFAM
          nc_5.8s_id98: 0     # non-coding - RFAM
      aligned.blast:
        num_recs:    520127
        n_yid_ycov:    1454
        n_yid_ncov:  346817
        n_nid_ycov:    5245
        n_denovo:    166611
      aligned_paired_fwd.fq.gz:     255660
      aligned_paired_rev.fq.gz:     255660
      aligned_singleton_fwd.fq.gz:    4132
      aligned_singleton_rev.fq.gz:    4675
      #other_paired_fwd.fq.gz:      474600
      #other_paired_rev.fq.gz:      474600
      #other_singleton_fwd.fq.gz:      456
      #other_singleton_rev.fq.gz:      435
  time:
    win_8_16:
      host: Windows 10 + 8 CPUs + 16 GiB RAM
      4-2-1:
        threads: 8
        total: 3167.055 # sec ~53min with indexing
        #  indexing, read count, idx stats, align, summary, report
        totals: [ 0, 24, 4, 0, 0, 0]
        align:  [ 183, 234, 265, 289, 155, 162, 187, 156 ] # sec
        ref:
          - {{DATA_DIR}}/logs/sortmerna/win10_8_16_smr_t42_20200811_0905.log  # trace
      4-3-1:
        threads: 8
        total: 1636.74 # sec ~27min, ~2 times faster
        #  indexing, read count, split, idx stats, align, summary, report
        totals: [ 0, 36, 347, 3, 857, 3, 430 ]
        align:  [ 126, 121, 142, 167, 66, 79, 87, 64 ]
        ref: 
          - {{DATA_DIR}}/sortmerna/logs/20210322_0836_win10_8_16_t42_th8.stdout # trace
          - {{DATA_DIR}}/logs/sortmerna/20210203_2025_win10_8_16_smr_t42.log  # trace
    ubuntu18_8_16_32:
      host: AWS c5.2xlarge + Ubuntu 18 + 8 cpu + 16 GB RAM + 32 GB HDD
      4-3-1:
        total:
        # indexing, read count, split, idx stats, align, summary, report
        totals: []
      4-2-0:
      info: |
        {{DATA_DIR}}/logs/sortmerna/
          aws_ubuntu18_8_16_smr_t42_20200811_1319.log
          aws_ubuntu18_8_16_smr_t42_20200812_1224.log
      total: 2112.456 # sec ~35min - 1.5 times faster than Win due the higher memory usage
      reads_stats_calc: [15.21, 15.25]
      index_stats_calc: [4.13]
      align:
        # slow because All reads were stored to DB. See results after the fix below.
        # AWS ExecutionTimedOut bug
        - [ 128, 129, 145, 156, 85, 96, 108, 80, 927 ] # sec Total: ~16min
        # aws_ubuntu18_8_16_smr_t42_20200812_1224.log  storing only reads with new alignments  20200812
        #   25% 30% 28%  23%  41% 45% 47% 38% better
        - [ 95, 91, 105, 121, 51, 53, 60, 50 ]  # sec Total: ~10min 33% better
      stats: [39,39,39,39,39,39,39,39] # sec Total: 312 = ~5min
      reports: []
    ubuntu18_16_32_32:
      host: AWS c5.4xlarge + Ubuntu 18 + 16 cpu + 32 GB RAM + 32 GB HDD
      4-2-1:
        total:  # sec 
        reads_stats_calc: [15.25, 15.29]
        index_stats_calc: [4.42]
        align: [ 56, 56, 61, 70, 53, 53, 54, 52 ]
        trace: {{DATA_DIR}}/logs/sortmerna/aws_ubuntu18_16_32_smr_t42_20200812_1441.log
        info: |
          Using 16 threads almost makes no sense. Compared to 8 threads the speed gain is minimal.
          The single reader is not fast enough to supply the reads, so the threads are idling.
      4-3-1:
        - threads: 16
          #total: 951 # sec  no indexing  20210307
          total: 1267 # sec ~21min with indexing  20210317
          # indexing, read count, split, idx stats, align, summary, report
          totals: [ 170, 35, 535, 4.1, 308, 4.1, 72 ]
          aws.cmd.id: 1aff1ea6-655a-46a2-8916-d4e295f9d397
          aws.trace:
            - {{ DATA_DIR }}/logs/aws/ssm/ubuntu18_16_32_32_t42_th16_20210307_1253.stdout
            - {{ DATA_DIR }}/logs/aws/ssm/ubuntu18_16_32_32_t42_th16_20210317_0943.stdout  # bit slower
          aws.yaml: sortmerna.data.load:t42,sortmerna.test.run
    ubuntu18_32_128_32:
      host: m5.8xlarge   cpu:32 ram:128  Intel Xeon Platinum 8000  general purpose  1.536
      4-3-1:
        - threads: 16
          total: 1103 # sec with indexing
          # indexing, read count, split, idx stats, align, summary, report
          totals: [ 186, 39, 606, 4.6, 239, 4.6, 48 ]  # sec
          aws.cmd.id: eb230865-ceb1-4250-8b52-40efc742b736
          aws.trace: {{ DATA_DIR }}/logs/aws/ssm/ubuntu18_32_128_32_t42_th16_20210307_1345.stdout
          aws.yaml: sortmerna.data.load:t42,sortmerna.test.run
          aligned.log: 
        - threads: 32
          total: 839 # sec no indexing
          totals: [ 186, 39, 607, 4.6, 166, 4.7, 42 ]
          aws.cmd.id: 0674c965-4ac1-4f17-b47b-6fce283f1797
          aws.trace: {{ DATA_DIR }}/logs/aws/ssm/ubuntu18_32_128_32_t42_th32_20210307_1419.stdout
          aws.yaml: sortmerna.data.load:t42,sortmerna.test.run
          aligned.log: {{STAT_DIR}}/sortmerna/out/20210307_1419_t42_aws_ubuntu18_32_128_32.log

t43:
  name: issue 231 8x50M
  info: |
    stress test - 8 reference databases, 50M reads

    refs  reads  paired  paired_in  paired_out  out2  sout  zout  other
    ------------------------------------------------------------------- output type
     8      2      -        -           -         -     -     y    -

    best  N  min_lis seeds
    ----------------------  alignment type
    true  1     2      2
  cmd:
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta  # 15M
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-18s-id95.fasta  # 13M
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-23s-id98.fasta  # 13M
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-16s-id90.fasta  # 19M
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-23s-id98.fasta  # 13M
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-16s-id95.fasta  # 3.8M
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5s-database-id98.fasta  # 8.2M
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5.8s-database-id98.fasta  # 2.2M
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_1.fastq.gz # 2 GB 24,654,594 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_2.fastq.gz # 2 GB 24,654,594 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -out2
    - -sout
    - -v
    - -workdir
    - {{ WRK_DIR }}
    - -threads
    - {{THREADS or '\'8\''}}
    - -index
    - {{INDEX or '\'2\''}}  # 2 is the default
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 49309188
        num_hits:   2499868
        num_fail:  46809320
        num_hits_db:
          euk_28s_id98: 0.51
          euk_18s_id95: 0.02
          bac_23s_id98: 3.18
          bac_16s_id90: 1.33
          arc_23s_id98: 0
          arc_16s_id95: 0
          nc_5s_id98:   0.03  # non-coding - RFAM
          nc_5.8s_id98: 0     # non-coding - RFAM
    time:
      win_8_16:
        host: Windows 10 + 8 CPUs + 16 GiB RAM
        notes: |
          Win apparently limits the amount of memory available to the process, 
          which seems to slow it down because less memory is available to RocksDB. 
          On Ubuntu the memory used by the process is much higher, and the process runs faster.
        4-2-1:
          - threads: 8
            total: 17587 # sec ~5hrs
            # indexing, read count, idx stats, align, summary, report
            totals: [ 0, 100, 3, 0,0,0,0 ] # sec
            align: [ 997, 1089, 1226, 1404, 760, 884, 1061, 888 ]  # sec  8 indices
        4-3-1:
          - threads: 8
            total: 10239 # sec ~2.8Hr
            # indexing, read count, split, idx stats, align, summary, report
            totals: [ 0, 177, 1870, 3, 5880, 4, 2305] # sec  600/10M=~60  1900/50M=~40
            align: [ 722, 635, 1007, 1719, 406, 476, 514, 391 ]
            trace: {{ DATA_DIR }}/sortmerna/logs/win10_8_16_t43_th8_20210321_2045.stdout
            out: {{ DATA_DIR }}/sortmerna/out/tests/t43/win10_8_16/20210321/
      ubuntu18_4_16_32:
        host: AWS t3.xlarge + Ubuntu 18 + 4 cpu + 16 GB RAM + 32 GB HDD
      ubuntu18_8_16_32:
        host: AWS c5.2xlarge + Ubuntu 18 + 8 cpu + 16 GB RAM + 32 GB HDD
        4-2-1:
          - threads: 8
            total:
            # indexing, read count, idx stats, align, summary, report
            totals: [0, 150, 4, 0,0,0]  # sec
            align: [ 635, 653, 729, 0,0,0,0,0]  # ExecutionTimedOut bug after 3 indices
      ubuntu18_16_64_32:
        host: AWS m5.4xlarge + Ubuntu 18 + 16 cpu + 64 GB RAM + 32 GB HD
        total:  # sec - python trace from command sent to response received - with indexing
        reads_stats_calc: [82, 82]
      ubuntu18_32_128_32:
        host: AWS m5.8xlarge + Ubuntu 18 + 32 cpu + 128 GB RAM + 32 GB HD
        info: testing on 50M reads always times-out after 3 indices.
        4-3-1:
          - threads: 32
            total: 4820 # sec - estimated ~80min ~4 times faster than 8 threads i.e. linear time
            #      3660 sec - python trace from command sent to response received. No indexing, early termination
            #      1598 sec - alignment only
            # indexing, read count, split, idx stats, align, summary, report
            totals: [ 186, 218, 3100, 5, 1034, 5, 269 ]   # sec,  3100/50=~60 (split)
            align:  [ 137, 124, 188, 286, 64, 80, 90, 62 ] # sec
            aws.cmd.id: 43b6b9d1-1162-4d8f-8885-18f160457c4c
            aws.trace: 
              - {{ DATA_DIR }}/logs/aws/ssm/ubuntu18_32_128_32_t43_th32_20210319_0904.stdout # complete alignment
              - {{ DATA_DIR }}/logs/aws/ssm/ubuntu18_32_128_32_t43_th32_20210318_0947.stdout # non-complete alignment
            aws.yaml: sortmerna.data.load:t43,sortmerna.test.run
            aligned.log: {{ DATA_DIR }}/sortmerna/out/20210319_0904_t43_aws_ubuntu18_32_128_32.log
    memory:
      prior_idx_load: [  5100]
      idx_load:       [378400]
      ref_load:       [395924]
      align_done:     [608508, 568984, 1185272, 1897344, 1702888, 1793292, ?, ?]
      idx_ref_unloaded:

t44:
  name: test concatenated gzip - issue 221,272,283
  info:
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/silva-bac-16s-database-id85.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/sortmerna/bugs/iss_283/1.concat.fq.gz # 224 reads
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/sortmerna/bugs/iss_283/2.concat.fq.gz # 224 reads
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -v
    - -out2
    - -dbg-level
    - '2'
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:  448
        num_hits:   134
        num_fail:   314
      aligned.blast.gz:
        num_recs:   448
        n_yid_ycov:  88 
        n_yid_ncov:  22 
        n_nid_ycov:  18 
        n_denovo:     6
      aligned_fwd.fq.gz: 67 # number of reads in 
      aligned_rev.fq.gz: 67

t44_2:
  name: test concatenated gzip 1M reads - issue 221,263,272,283
  info: |
    The same reads as used for test 41
    5 files (430K,370K,450K,350K,400K) catenated into a single one:
      cat SRR1635864_1_2M_1.fq.gz SRR1635864_1_2M_2.fq.gz SRR1635864_1_2M_3.fq.gz 
          SRR1635864_1_2M_4.fq.gz SRR1635864_1_2M_5.fq.gz > SRR1635864_1_2M_cat.fq.gz  # second file is similar
  cmd:
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-28s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-euk-18s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-bac-16s-id90.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-23s-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/silva-arc-16s-id95.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5s-database-id98.fasta
    - -ref
    -  {{ SMR_SRC }}/data/rRNA_databases/rfam-5.8s-database-id98.fasta
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_1_2M_cat.fq.gz # 40MB, 500,000 reads  5 aprts
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_2_2M_cat.fq.gz # 40MB, 500,000 reads  5 parts
    - -fastx
    - -blast
    - '1 cigar qcov'
    - -out2
    - -sout
    - -other
    - -v
    - -threads
    - {{THREADS or '\'8\''}}
    - -index
    - {{INDEX or '\'2\''}}  # 2 is the default
    - -workdir
    - {{ WRK_DIR }}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads: 1000000
        num_hits:    49909
        num_fail:   950091
      aligned.blast:
        num_recs:    49909
        n_yid_ycov:    181 
        n_yid_ncov:  33018 
        n_nid_ycov:    494 
        n_denovo:    16216
      aligned_paired_fwd.fq.gz:  24509
      aligned_paired_rev.fq.gz:  24509
      aligned_singleton_fwd.fq.gz: 435
      aligned_singleton_rev.fq.gz: 456
      other_paired_fwd.fq.gz:   474600
      other_paired_rev.fq.gz:   474600
      other_singleton_fwd.fq.gz:   456
      other_singleton_rev.fq.gz:   435
  time:
    win_8_16:
      host: Windows 10 + 8 CPUs + 16 GiB RAM
      4-3-2:
      - threads: 8
        total: 203 # sec no indexing
        # indexing, read count, idx stats, align, summary, report
        totals: [ 0, 4, 37, 103, 3, 56]
        align:  [ 13, 13, 17, 19, 7, 8, 9, 7 ] # sec per part

t45:
  name: issue 288 - segfault on '-other'
  info: |
    xxx
  cmd:
    - -ref
    - {{ SMR_SRC }}/data/rRNA_databases/smr_v4.3_default_db.fasta  # 140MB
    - -reads
    - {{ DATA_DIR if DATA_DIR }}/bio/reads/rna/SRR1635864_2x2M_merged.fastq # 261MB, 2x500,000 reads
    - -paired
    - -fastx
    - -other
    - -out2
    - -num_alignments 
    - '1'
    - -v
    - -dbg-level
    - '2'
    - -threads
    - {{THREADS or '\'8\''}}
    - -index
    - {{INDEX or '\'2\''}}  # 2 is the default
    - -task
    - {{TASK or '\'4\''}}  # 4 is default
    - -workdir
    - {{ WRK_DIR }}
  cwd: {{ SMR_SRC }}
  validate:
    func:
    variant: sanger # fastq quality variant
    files:
      aligned.log:
        num_reads:  1000000
        num_hits:    103270
        num_fail:    896730
      aligned_fwd.fq: 52382
      aligned_rev.fq: 50888
      other_fwd.fq:  447618
      other_rev.fq:  449112
      aligned.blast:
        num_recs:   1000000 # num_pass_id_cov + num_denovo + num_y_id_n_cov + num_n_id_y_cov = 19995 = num_hits
        n_yid_ycov:       0 # lin:43678  num_pass_id ⋂ num_pass_cov
  time:
    win_8_16:
      host: Windows 10 + 8 CPUs + 16GB RAM
      4-3-2:
      - threads: 8
        total: 203 # sec no indexing
        # indexing, read count, readfeed, align, summary, report
        totals: [ 0, 13, 26, 76, 1, 18]
    lnx_vbox_centos_77:
      host: Centos 77 on VBox + 8 CPU + 4GB RAM
      4-3-2:
      - threads: 8
        total: 1826 # sec - indexing slow - too little RAM
        # indexing, read count, readfeed, align, summary, report
        totals: [ 1038, 3, 5, 765, 1, 14]

# aligned.log file structure
aligned.log:
  cmd: ['Command', None]
  pid: ['Process pid', None]
  params:
    refs: []
  num_reads: ['Total reads =', 0]
  results:
    num_hits:   ['Total reads passing E-value threshold', 0]
    num_fail:   ['Total reads failing E-value threshold', 0]
    num_denovo: ['Total reads for de novo clustering', 0]
    min_len:    ['Minimum read length', 0]
    max_len:    ['Maximum read length', 0]
    mean_len:   ['Mean read length', 0]
  coverage:     []
  num_id_cov:   ['Total reads passing %%id and %%coverage thresholds', 0]
  num_otus:     ['Total OTUs', 0]
  date: None

# all possible file base names for aligned output
# fa/fq, gz/non-gz  (7 x 4 = 28)
aligned.names:
  - aligned
  - aligned_fwd
  - aligned_rev
  - aligned_paired_fwd
  - aligned_paired_rev
  - aligned_singleton_fwd
  - aligned_singleton_rev